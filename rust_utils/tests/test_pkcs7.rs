use rust_utils::*;

/*----------------------------------------------------------------------------*/
// Padding and Stripping

#[test]
pub fn test_padding() {
    let m1 = [
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115,
    ];
    let m1_pad: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 16, 16, 16,
        16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16,
    ];

    let m2 = [
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114,
    ];
    let m2_pad: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 1,
    ];

    let m3 = [
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113,
    ];

    let m3_pad: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 2, 2,
    ];

    assert_eq!(pkcs7::pad(&m1), m1_pad);
    assert_eq!(pkcs7::pad(&m2), m2_pad);
    assert_eq!(pkcs7::pad(&m3), m3_pad);
}

#[test]
pub fn test_stripping() {
    let m1: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115,
    ];
    let m1_pad: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 16, 16, 16,
        16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16,
    ];

    let m2: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114,
    ];
    let m2_pad: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 1,
    ];

    let m3: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113,
    ];

    let m3_pad: Vec<u8> = vec![
        100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 2, 2,
    ];

    assert_eq!(pkcs7::strip(&m1_pad), Some(m1));
    assert_eq!(pkcs7::strip(&m2_pad), Some(m2));
    assert_eq!(pkcs7::strip(&m3_pad), Some(m3));
}

#[test]
pub fn test_valid() {
    assert!(pkcs7::valid_padding(&[100, 1]));
    assert!(pkcs7::valid_padding(&[100, 2, 2, 2]));
    assert!(!pkcs7::valid_padding(&[100, 3, 3]));
    assert!(!pkcs7::valid_padding(&[100, 1, 2, 3, 4, 5]));
}
